BEGIN

DECLARE tipo_operacao varchar(50);
DECLARE estado varchar(50);
DECLARE data timestamp;
DECLARE ficheiro varchar(50);
DECLARE data_inicio timestamp;
DECLARE data_fim timestamp;
DECLARE numero_entradas int;
DECLARE numero_entradas_total int;
DECLARE data_inicio_SP timestamp;
DECLARE data_fim_SP TIMESTAMP;
DECLARE id_novo int;
DECLARE numero_entradas_novo int;
DECLARE numero_entradas_total_novo int;
DECLARE agendada_extra varchar(50) DEFAULT 'AGENDADA';
DECLARE agora TIMESTAMP DEFAULT '0000-00-00 00:00:00';
DECLARE temp int;
DECLARE temp2 varchar(50);



SELECT ficheiro_controlo.tipo_operacao INTO tipo_operacao FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.estado INTO estado FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.data INTO data FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.ficheiro INTO ficheiro FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.data_inicio INTO data_inicio FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.data_fim INTO data_fim FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.numero_entradas INTO numero_entradas FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SELECT ficheiro_controlo.numero_entradas_total INTO numero_entradas_total FROM ficheiro_controlo ORDER BY ficheiro_controlo.tipo_operacao DESC LIMIT 1;
SET id_novo = tipo_operacao + 1;

CASE estado
	WHEN 'OK' THEN 
	
SET numero_entradas_novo = (SELECT COUNT(*) FROM (SELECT 'logalerta',logalerta.idlogAlerta,logalerta.IDAlerta,logalerta.TipoAlerta,logalerta.DataHoraAlerta,logalerta.IDMedicao,logalerta.ValorMedicao,logalerta.TipoSensor,logalerta.DataHoraMedicao,logalerta.EmailUtilizadorConsultor,logalerta.NomeUtilizadorConsultor,logalerta.TipoUtilizadorConsultor,logalerta.Data,logalerta.Comando,logalerta.Resultado, ''  from logalerta WHERE data < logalerta.data UNION SELECT 'logcartao',logcartao.idlogCartao, logcartao.idCartao, logcartao.Ativo, logcartao.EmailUtilizador, logcartao.NomeUtilizador, logcartao.TipoUtilizador, logcartao.EmailUtilizadorConsultor, logcartao.NomeUtilizadorConsultor, logcartao.TipoUtilizadorConsultor, logcartao.Data,logcartao.Comando,logcartao.Resultado, '','','' FROM logcartao WHERE data < logcartao.data UNION SELECT 'logmedicaosensores',logmedicaosensores.idLogMedicao, logmedicaosensores.IDmedicao, logmedicaosensores.TipoSensor,logmedicaosensores.DataHoraMedicao,logmedicaosensores.EmailUtilizadorConsultor,logmedicaosensores.NomeUtilizadorConsultor,logmedicaosensores.TipoUtilizadorConsultor,logmedicaosensores.Data,logmedicaosensores.Comando, logmedicaosensores.Resultado, logmedicaosensores.PossivelAnomalia, '', '', '', '' FROM logmedicaosensores  WHERE data < logmedicaosensores.data UNION SELECT 'logronda', logronda.idlogRonda, logronda.DiaSemana, logronda.HoraRonda, logronda.Duracao, logronda.EmailUtilizador, logronda.NomeUtilizador, logronda.TipoUtilizador, logronda.EmailUtilizadorConsultor, logronda.NomeUtilizadorConsultor, logronda.TipoUtilizadorConsultor, logronda.Data, logronda.Comando, logronda.Resultado, '', '' from logronda  WHERE data < logronda.data UNION SELECT 'logrondaextra',logrondaextra.idlogRondaExtra, logrondaextra.DataHora, logrondaextra.EmailUtilizador, logrondaextra.NomeUtilizador, logrondaextra.TipoUtilizador, logrondaextra.EmailUtilizadorConsultor, logrondaextra.NomeUtilizadorConsultor, logrondaextra.TipoUtilizadorConsultor, logrondaextra.Data, logrondaextra.Comando, logrondaextra.Resultado,'','','','' from logrondaextra  WHERE data < logrondaextra.data UNION SELECT 'logsistema',logsistema.idlogSistema, logsistema.IDSistema, logsistema.LimiteTemperatura, logsistema.LimiteHumidade, logsistema.LimiteLuminosidade, logsistema.LimiarTemperatura, logsistema.LimiarHumidade, logsistema.LimiarLuminosidade, logsistema.DuracaoPadraoRonda, logsistema.EmailUtilizadorConsultor,logsistema.NomeUtilizadorConsultor, logsistema.TipoUtilizadorConsultor, logsistema.Data, logsistema.Comando, logsistema.Resultado from logsistema  WHERE data < logsistema.data UNION
SELECT 'logutilizador', logutilizador.idlogUtilizador, logutilizador.EmailUtilizadorConsultado, logutilizador.NomeUtilizadorConsultado, logutilizador.TipoUtilizadorConsultado, logutilizador.EmailUtilizadorConsultor, logutilizador.NomeUtilizadorConsultor, logutilizador.TipoUtilizadorConsultor, logutilizador.Data, logutilizador.Comando, logutilizador.Resultado, '' , '' ,'', '', ''  from logutilizador  WHERE data < logutilizador.data) AS numero_entradas_novo);
SELECT numero_entradas_novo, numero_entradas_total;
SET numero_entradas_total_novo = numero_entradas_novo + numero_entradas_total;
SELECT 'logalerta',logalerta.idlogAlerta AS '',logalerta.IDAlerta,logalerta.TipoAlerta AS '',logalerta.DataHoraAlerta AS '',logalerta.IDMedicao  AS '',logalerta.ValorMedicao AS '',logalerta.TipoSensor AS '',logalerta.DataHoraMedicao AS '',logalerta.EmailUtilizadorConsultor AS '',logalerta.NomeUtilizadorConsultor AS '',logalerta.TipoUtilizadorConsultor AS '',logalerta.Data AS '',logalerta.Comando AS '',logalerta.Resultado AS '', ''  from logalerta WHERE data < logalerta.data UNION SELECT 'logcartao',logcartao.idlogCartao AS '', logcartao.idCartao AS '', logcartao.Ativo AS '', logcartao.EmailUtilizador AS '', logcartao.NomeUtilizador AS '', logcartao.TipoUtilizador AS '', logcartao.EmailUtilizadorConsultor AS '', logcartao.NomeUtilizadorConsultor AS '', logcartao.TipoUtilizadorConsultor AS '', logcartao.Data AS '',logcartao.Comando AS '',logcartao.Resultado AS '', '','','' FROM logcartao WHERE data < logcartao.data UNION SELECT 'logmedicaosensores',logmedicaosensores.idLogMedicao AS '', logmedicaosensores.IDmedicao AS '', logmedicaosensores.TipoSensor AS '',logmedicaosensores.DataHoraMedicao AS '',logmedicaosensores.EmailUtilizadorConsultor AS '',logmedicaosensores.NomeUtilizadorConsultor AS '',logmedicaosensores.TipoUtilizadorConsultor AS '',logmedicaosensores.Data AS '',logmedicaosensores.Comando AS '', logmedicaosensores.Resultado AS '', logmedicaosensores.PossivelAnomalia AS '', '', '', '', '' FROM logmedicaosensores  WHERE data < logmedicaosensores.data UNION SELECT 'logronda', logronda.idlogRonda AS '', logronda.DiaSemana AS '', logronda.HoraRonda AS '', logronda.Duracao AS '', logronda.EmailUtilizador AS '', logronda.NomeUtilizador AS '', logronda.TipoUtilizador AS '', logronda.EmailUtilizadorConsultor AS '', logronda.NomeUtilizadorConsultor AS '', logronda.TipoUtilizadorConsultor AS '', logronda.Data AS '', logronda.Comando AS '', logronda.Resultado, '', '' from logronda  WHERE data < logronda.data UNION SELECT 'logrondaextra',logrondaextra.idlogRondaExtra AS '', logrondaextra.DataHora AS '', logrondaextra.EmailUtilizador AS '', logrondaextra.NomeUtilizador AS '', logrondaextra.TipoUtilizador AS '', logrondaextra.EmailUtilizadorConsultor AS '', logrondaextra.NomeUtilizadorConsultor AS '', logrondaextra.TipoUtilizadorConsultor AS '', logrondaextra.Data AS '', logrondaextra.Comando AS '', logrondaextra.Resultado AS '','','','',''  from logrondaextra  WHERE data < logrondaextra.data UNION SELECT 'logsistema',logsistema.idlogSistema AS '', logsistema.IDSistema AS '', logsistema.LimiteTemperatura AS '', logsistema.LimiteHumidade AS '', logsistema.LimiteLuminosidade AS '', logsistema.LimiarTemperatura AS '', logsistema.LimiarHumidade AS '', logsistema.LimiarLuminosidade AS '', logsistema.DuracaoPadraoRonda AS '', logsistema.EmailUtilizadorConsultor AS '',logsistema.NomeUtilizadorConsultor AS '', logsistema.TipoUtilizadorConsultor AS '', logsistema.Data AS '', logsistema.Comando AS '', logsistema.Resultado AS '' from logsistema  WHERE data < logsistema.data UNION
SELECT 'logutilizador', logutilizador.idlogUtilizador AS '', logutilizador.EmailUtilizadorConsultado AS '', logutilizador.NomeUtilizadorConsultado AS '', logutilizador.TipoUtilizadorConsultado AS '', logutilizador.EmailUtilizadorConsultor AS '', logutilizador.NomeUtilizadorConsultor AS '', logutilizador.TipoUtilizadorConsultor AS '', logutilizador.Data AS '', logutilizador.Comando AS '', logutilizador.Resultado AS '', '' , '' ,'', '', ''  from logutilizador  WHERE data < logutilizador.data 
UNION SELECT id_novo ,agendada_extra,agora,ficheiro,temp2, '','','','','','','','','','','' 

INTO OUTFILE "C:/Users/joaof/OneDrive - ISCTE-IUL/SID/teste1.csv"
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n';

WHEN 'EXTRA' THEN 
	IF data_inicio IS NULL AND data_fim IS NOT NULL THEN SET data_inicio_SP = '2013-07-22 12:50:05' ; SET data_fim_SP = data_fim; ELSEIF
     data_fim IS NULL AND data_inicio IS NOT NULL  THEN  SET data_fim_SP = CURRENT_TIMESTAMP; SET data_inicio_SP = data_inicio; 
     ELSE  SET data_inicio_SP = data_inicio ; SET data_fim_SP = data_fim; END IF;
    SET numero_entradas_novo = (SELECT COUNT(*) FROM (SELECT 'logalerta',logalerta.idlogAlerta ,logalerta.IDAlerta,logalerta.TipoAlerta ,logalerta.DataHoraAlerta ,logalerta.IDMedicao  ,logalerta.ValorMedicao ,logalerta.TipoSensor ,logalerta.DataHoraMedicao ,logalerta.EmailUtilizadorConsultor ,logalerta.NomeUtilizadorConsultor ,logalerta.TipoUtilizadorConsultor ,logalerta.Data ,logalerta.Comando ,logalerta.Resultado , ''  from logalerta WHERE data_fim_SP > logalerta.data AND data_inicio_SP < logalerta.data UNION SELECT 'logcartao',logcartao.idlogCartao , logcartao.idCartao , logcartao.Ativo , logcartao.EmailUtilizador , logcartao.NomeUtilizador , logcartao.TipoUtilizador , logcartao.EmailUtilizadorConsultor , logcartao.NomeUtilizadorConsultor , logcartao.TipoUtilizadorConsultor , logcartao.Data ,logcartao.Comando ,logcartao.Resultado , '','','' FROM logcartao WHERE data_fim_SP > logcartao.data AND data_inicio_SP < logcartao.data UNION SELECT 'logmedicaosensores',logmedicaosensores.idLogMedicao , logmedicaosensores.IDmedicao , logmedicaosensores.TipoSensor ,logmedicaosensores.DataHoraMedicao ,logmedicaosensores.EmailUtilizadorConsultor ,logmedicaosensores.NomeUtilizadorConsultor ,logmedicaosensores.TipoUtilizadorConsultor ,logmedicaosensores.Data ,logmedicaosensores.Comando , logmedicaosensores.Resultado , logmedicaosensores.PossivelAnomalia , '', '', '', '' FROM logmedicaosensores  WHERE data_fim_SP > logmedicaosensores.data AND data_inicio_SP < logmedicaosensores.data UNION SELECT 'logronda', logronda.idlogRonda , logronda.DiaSemana , logronda.HoraRonda , logronda.Duracao , logronda.EmailUtilizador , logronda.NomeUtilizador , logronda.TipoUtilizador , logronda.EmailUtilizadorConsultor , logronda.NomeUtilizadorConsultor , logronda.TipoUtilizadorConsultor , logronda.Data , logronda.Comando , logronda.Resultado, '', '' from logronda  WHERE data_fim_SP > logronda.data AND data_inicio_SP < logronda.data UNION SELECT 'logrondaextra',logrondaextra.idlogRondaExtra , logrondaextra.DataHora , logrondaextra.EmailUtilizador , logrondaextra.NomeUtilizador , logrondaextra.TipoUtilizador , logrondaextra.EmailUtilizadorConsultor , logrondaextra.NomeUtilizadorConsultor , logrondaextra.TipoUtilizadorConsultor , logrondaextra.Data , logrondaextra.Comando , logrondaextra.Resultado ,'','','',''  from logrondaextra  WHERE data_fim_SP > logrondaextra.data AND data_inicio_SP < logrondaextra.data UNION SELECT 'logsistema',logsistema.idlogSistema , logsistema.IDSistema , logsistema.LimiteTemperatura , logsistema.LimiteHumidade , logsistema.LimiteLuminosidade , logsistema.LimiarTemperatura , logsistema.LimiarHumidade , logsistema.LimiarLuminosidade , logsistema.DuracaoPadraoRonda , logsistema.EmailUtilizadorConsultor ,logsistema.NomeUtilizadorConsultor , logsistema.TipoUtilizadorConsultor , logsistema.Data , logsistema.Comando , logsistema.Resultado  from logsistema  WHERE data_fim_SP > logsistema.data AND data_inicio_SP < logsismtema.data UNION
SELECT 'logutilizador', logutilizador.idlogUtilizador , logutilizador.EmailUtilizadorConsultado , logutilizador.NomeUtilizadorConsultado , logutilizador.TipoUtilizadorConsultado , logutilizador.EmailUtilizadorConsultor , logutilizador.NomeUtilizadorConsultor , logutilizador.TipoUtilizadorConsultor , logutilizador.Data , logutilizador.Comando , logutilizador.Resultado , '' , '' ,'', '', '' from logutilizador  WHERE data_fim_SP > logutilizador.data AND data_inicio_SP < logutilizador.data) as numero_entradas_novo);
     SELECT 'logalerta',logalerta.idlogAlerta AS '',logalerta.IDAlerta,logalerta.TipoAlerta AS '',logalerta.DataHoraAlerta AS '',logalerta.IDMedicao  AS '',logalerta.ValorMedicao AS '',logalerta.TipoSensor AS '',logalerta.DataHoraMedicao AS '',logalerta.EmailUtilizadorConsultor AS '',logalerta.NomeUtilizadorConsultor AS '',logalerta.TipoUtilizadorConsultor AS '',logalerta.Data AS '',logalerta.Comando AS '',logalerta.Resultado AS '', ''  from logalerta WHERE data_fim_SP > logalerta.data AND data_inicio_SP < logalerta.data UNION SELECT 'logcartao',logcartao.idlogCartao AS '', logcartao.idCartao AS '', logcartao.Ativo AS '', logcartao.EmailUtilizador AS '', logcartao.NomeUtilizador AS '', logcartao.TipoUtilizador AS '', logcartao.EmailUtilizadorConsultor AS '', logcartao.NomeUtilizadorConsultor AS '', logcartao.TipoUtilizadorConsultor AS '', logcartao.Data AS '',logcartao.Comando AS '',logcartao.Resultado AS '', '','','' FROM logcartao WHERE data_fim_SP > logcartao.data AND data_inicio_SP < logcartao.data UNION SELECT 'logmedicaosensores',logmedicaosensores.idLogMedicao AS '', logmedicaosensores.IDmedicao AS '', logmedicaosensores.TipoSensor AS '',logmedicaosensores.DataHoraMedicao AS '',logmedicaosensores.EmailUtilizadorConsultor AS '',logmedicaosensores.NomeUtilizadorConsultor AS '',logmedicaosensores.TipoUtilizadorConsultor AS '',logmedicaosensores.Data AS '',logmedicaosensores.Comando AS '', logmedicaosensores.Resultado AS '', logmedicaosensores.PossivelAnomalia AS '', '', '', '', '' FROM logmedicaosensores  WHERE data_fim_SP > logmedicaosensores.data AND data_inicio_SP < logmedicaosensores.data UNION SELECT 'logronda', logronda.idlogRonda AS '', logronda.DiaSemana AS '', logronda.HoraRonda AS '', logronda.Duracao AS '', logronda.EmailUtilizador AS '', logronda.NomeUtilizador AS '', logronda.TipoUtilizador AS '', logronda.EmailUtilizadorConsultor AS '', logronda.NomeUtilizadorConsultor AS '', logronda.TipoUtilizadorConsultor AS '', logronda.Data AS '', logronda.Comando AS '', logronda.Resultado, '', '' from logronda  WHERE data_fim_SP > logronda.data AND data_inicio_SP < logronda.data UNION SELECT 'logrondaextra',logrondaextra.idlogRondaExtra AS '', logrondaextra.DataHora AS '', logrondaextra.EmailUtilizador AS '', logrondaextra.NomeUtilizador AS '', logrondaextra.TipoUtilizador AS '', logrondaextra.EmailUtilizadorConsultor AS '', logrondaextra.NomeUtilizadorConsultor AS '', logrondaextra.TipoUtilizadorConsultor AS '', logrondaextra.Data AS '', logrondaextra.Comando AS '', logrondaextra.Resultado AS '','','','',''  from logrondaextra  WHERE data_fim_SP > logrondaextra.data AND data_inicio_SP < logrondaextra.data UNION SELECT 'logsistema',logsistema.idlogSistema AS '', logsistema.IDSistema AS '', logsistema.LimiteTemperatura AS '', logsistema.LimiteHumidade AS '', logsistema.LimiteLuminosidade AS '', logsistema.LimiarTemperatura AS '', logsistema.LimiarHumidade AS '', logsistema.LimiarLuminosidade AS '', logsistema.DuracaoPadraoRonda AS '', logsistema.EmailUtilizadorConsultor AS '',logsistema.NomeUtilizadorConsultor AS '', logsistema.TipoUtilizadorConsultor AS '', logsistema.Data AS '', logsistema.Comando AS '', logsistema.Resultado AS '' from logsistema  WHERE data_fim_SP > logsistema.data AND data_inicio_SP < logsismtema.data UNION
SELECT 'logutilizador', logutilizador.idlogUtilizador AS '', logutilizador.EmailUtilizadorConsultado AS '', logutilizador.NomeUtilizadorConsultado AS '', logutilizador.TipoUtilizadorConsultado AS '', logutilizador.EmailUtilizadorConsultor AS '', logutilizador.NomeUtilizadorConsultor AS '', logutilizador.TipoUtilizadorConsultor AS '', logutilizador.Data AS '', logutilizador.Comando AS '', logutilizador.Resultado AS '', '' , '' ,'', '', '' from logutilizador  WHERE data_fim_SP > logutilizador.data AND data_inicio_SP < logutilizador.data UNION SELECT id_novo ,agendada_extra,agora,ficheiro,temp2, '','','','','','','','','','','' 
INTO OUTFILE "C:/Users/joaof/OneDrive - ISCTE-IUL/SID/teste1.csv"
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n';
WHEN 'NOK' THEN 
SET numero_entradas_novo = (SELECT COUNT(*) FROM (
	SELECT 'logalerta',logalerta.idlogAlerta ,logalerta.IDAlerta,logalerta.TipoAlerta ,logalerta.DataHoraAlerta ,logalerta.IDMedicao  ,logalerta.ValorMedicao ,logalerta.TipoSensor ,logalerta.DataHoraMedicao ,logalerta.EmailUtilizadorConsultor ,logalerta.NomeUtilizadorConsultor ,logalerta.TipoUtilizadorConsultor ,logalerta.Data ,logalerta.Comando ,logalerta.Resultado , '' from logalerta  WHERE data_inicio < logalerta.data UNION SELECT 'logcartao',logcartao.idlogCartao , logcartao.idCartao , logcartao.Ativo , logcartao.EmailUtilizador , logcartao.NomeUtilizador , logcartao.TipoUtilizador , logcartao.EmailUtilizadorConsultor , logcartao.NomeUtilizadorConsultor , logcartao.TipoUtilizadorConsultor , logcartao.Data ,logcartao.Comando ,logcartao.Resultado , '','','' FROM logcartao WHERE data_inicio < logcartao.data UNION SELECT 'logmedicaosensores',logmedicaosensores.idLogMedicao , logmedicaosensores.IDmedicao , logmedicaosensores.TipoSensor ,logmedicaosensores.DataHoraMedicao ,logmedicaosensores.EmailUtilizadorConsultor ,logmedicaosensores.NomeUtilizadorConsultor ,logmedicaosensores.TipoUtilizadorConsultor ,logmedicaosensores.Data ,logmedicaosensores.Comando , logmedicaosensores.Resultado , logmedicaosensores.PossivelAnomalia , '', '', '', '' FROM logmedicaosensores  WHERE data_inicio < logmedicaosensores.data UNION SELECT 'logronda', logronda.idlogRonda , logronda.DiaSemana , logronda.HoraRonda , logronda.Duracao , logronda.EmailUtilizador , logronda.NomeUtilizador , logronda.TipoUtilizador , logronda.EmailUtilizadorConsultor , logronda.NomeUtilizadorConsultor , logronda.TipoUtilizadorConsultor , logronda.Data , logronda.Comando , logronda.Resultado, '', '' from logronda  WHERE data_inicio < logronda.data UNION SELECT 'logrondaextra',logrondaextra.idlogRondaExtra , logrondaextra.DataHora , logrondaextra.EmailUtilizador , logrondaextra.NomeUtilizador , logrondaextra.TipoUtilizador , logrondaextra.EmailUtilizadorConsultor , logrondaextra.NomeUtilizadorConsultor , logrondaextra.TipoUtilizadorConsultor , logrondaextra.Data , logrondaextra.Comando , logrondaextra.Resultado ,'','','',''  from logrondaextra  WHERE data_inicio < logrondaextra.data UNION SELECT 'logsistema',logsistema.idlogSistema , logsistema.IDSistema , logsistema.LimiteTemperatura , logsistema.LimiteHumidade , logsistema.LimiteLuminosidade , logsistema.LimiarTemperatura , logsistema.LimiarHumidade , logsistema.LimiarLuminosidade , logsistema.DuracaoPadraoRonda , logsistema.EmailUtilizadorConsultor ,logsistema.NomeUtilizadorConsultor , logsistema.TipoUtilizadorConsultor , logsistema.Data , logsistema.Comando , logsistema.Resultado  from logsistema  WHERE data_inicio < logsistema.data UNION
SELECT 'logutilizador', logutilizador.idlogUtilizador , logutilizador.EmailUtilizadorConsultado , logutilizador.NomeUtilizadorConsultado , logutilizador.TipoUtilizadorConsultado , logutilizador.EmailUtilizadorConsultor , logutilizador.NomeUtilizadorConsultor , logutilizador.TipoUtilizadorConsultor , logutilizador.Data , logutilizador.Comando , logutilizador.Resultado , '' , '' ,'', '', '' from logutilizador  WHERE data_inicio < logutilizador.data) as entradas_novas);	
     SELECT 'logalerta',logalerta.idlogAlerta AS '',logalerta.IDAlerta,logalerta.TipoAlerta AS '',logalerta.DataHoraAlerta AS '',logalerta.IDMedicao  AS '',logalerta.ValorMedicao AS '',logalerta.TipoSensor AS '',logalerta.DataHoraMedicao AS '',logalerta.EmailUtilizadorConsultor AS '',logalerta.NomeUtilizadorConsultor AS '',logalerta.TipoUtilizadorConsultor AS '',logalerta.Data AS '',logalerta.Comando AS '',logalerta.Resultado AS '', '' from logalerta  WHERE data_inicio < logalerta.data UNION SELECT 'logcartao',logcartao.idlogCartao AS '', logcartao.idCartao AS '', logcartao.Ativo AS '', logcartao.EmailUtilizador AS '', logcartao.NomeUtilizador AS '', logcartao.TipoUtilizador AS '', logcartao.EmailUtilizadorConsultor AS '', logcartao.NomeUtilizadorConsultor AS '', logcartao.TipoUtilizadorConsultor AS '', logcartao.Data AS '',logcartao.Comando AS '',logcartao.Resultado AS '', '','','' FROM logcartao WHERE data_inicio < logcartao.data UNION SELECT 'logmedicaosensores',logmedicaosensores.idLogMedicao AS '', logmedicaosensores.IDmedicao AS '', logmedicaosensores.TipoSensor AS '',logmedicaosensores.DataHoraMedicao AS '',logmedicaosensores.EmailUtilizadorConsultor AS '',logmedicaosensores.NomeUtilizadorConsultor AS '',logmedicaosensores.TipoUtilizadorConsultor AS '',logmedicaosensores.Data AS '',logmedicaosensores.Comando AS '', logmedicaosensores.Resultado AS '', logmedicaosensores.PossivelAnomalia AS '', '', '', '', '' FROM logmedicaosensores  WHERE data_inicio < logmedicaosensores.data UNION SELECT 'logronda', logronda.idlogRonda AS '', logronda.DiaSemana AS '', logronda.HoraRonda AS '', logronda.Duracao AS '', logronda.EmailUtilizador AS '', logronda.NomeUtilizador AS '', logronda.TipoUtilizador AS '', logronda.EmailUtilizadorConsultor AS '', logronda.NomeUtilizadorConsultor AS '', logronda.TipoUtilizadorConsultor AS '', logronda.Data AS '', logronda.Comando AS '', logronda.Resultado, '', '' from logronda  WHERE data_inicio < logronda.data UNION SELECT 'logrondaextra',logrondaextra.idlogRondaExtra AS '', logrondaextra.DataHora AS '', logrondaextra.EmailUtilizador AS '', logrondaextra.NomeUtilizador AS '', logrondaextra.TipoUtilizador AS '', logrondaextra.EmailUtilizadorConsultor AS '', logrondaextra.NomeUtilizadorConsultor AS '', logrondaextra.TipoUtilizadorConsultor AS '', logrondaextra.Data AS '', logrondaextra.Comando AS '', logrondaextra.Resultado AS '','','','',''  from logrondaextra  WHERE data_inicio < logrondaextra.data UNION SELECT 'logsistema',logsistema.idlogSistema AS '', logsistema.IDSistema AS '', logsistema.LimiteTemperatura AS '', logsistema.LimiteHumidade AS '', logsistema.LimiteLuminosidade AS '', logsistema.LimiarTemperatura AS '', logsistema.LimiarHumidade AS '', logsistema.LimiarLuminosidade AS '', logsistema.DuracaoPadraoRonda AS '', logsistema.EmailUtilizadorConsultor AS '',logsistema.NomeUtilizadorConsultor AS '', logsistema.TipoUtilizadorConsultor AS '', logsistema.Data AS '', logsistema.Comando AS '', logsistema.Resultado AS '' from logsistema  WHERE data_inicio < logsistema.data UNION
SELECT 'logutilizador', logutilizador.idlogUtilizador AS '', logutilizador.EmailUtilizadorConsultado AS '', logutilizador.NomeUtilizadorConsultado AS '', logutilizador.TipoUtilizadorConsultado AS '', logutilizador.EmailUtilizadorConsultor AS '', logutilizador.NomeUtilizadorConsultor AS '', logutilizador.TipoUtilizadorConsultor AS '', logutilizador.Data AS '', logutilizador.Comando AS '', logutilizador.Resultado AS '', '' , '' ,'', '', '' from logutilizador  WHERE data_inicio < logutilizador.data UNION SELECT id_novo ,agendada_extra,agora,ficheiro,temp2, '','','','','','','','','','','' 
INTO OUTFILE "C:/Users/joaof/OneDrive - ISCTE-IUL/SID/teste1.csv"
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n';

ELSE SELECT 'ERROR'
INTO OUTFILE "C:/Users/joaof/OneDrive - ISCTE-IUL/SID/teste1.csv"
FIELDS TERMINATED BY ';'
ENCLOSED BY '"'
LINES TERMINATED BY '\n';
END CASE;


	



END
