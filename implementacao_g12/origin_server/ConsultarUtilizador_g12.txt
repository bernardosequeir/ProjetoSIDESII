CREATE DEFINER=`root`@`localhost` PROCEDURE `ConsultarUtilizador`(Email VARCHAR(100))
BEGIN
	SELECT user INTO @userId FROM (
		SELECT user, CONCAT(user, '@', host) as userhost FROM mysql.user) base
    WHERE userhost = USER();
	SELECT default_role INTO @role FROM (
        SELECT default_role, CONCAT(user, '@', host) as userhost FROM mysql.user) base
    WHERE userhost = USER();
	 IF(CURRENT_ROLE = 'chefe_seguranca' OR @role= 'chefe_seguranca') THEN
		SELECT NomeUtilizador FROM utilizador WHERE EmailUtilizador = Email INTO @Nomee;
        SELECT TipoUtilizador FROM utilizador WHERE EmailUtilizador = Email INTO @Tipoo;
        SELECT Morada FROM utilizador WHERE EmailUtilizador = Email INTo @Morada;
        SELECT Morada FROM utilizador WHERE EmailUtilizador = Email INTo @cMorada;
        SELECT NomeUtilizador FROM utilizador WHERE EmailUtilizador = @userId INTO @cNomee;
        SELECT TipoUtilizador FROM utilizador WHERE EmailUtilizador = @userId INTO @cTipoo;
		IF (Email = 'NULL') Then
			SELECT * FROM utilizador where (TipoUtilizador = 'SEG' OR EmailUtilizador = @userId);
            INSERT INTO g12_loguser VALUES ( DEFAULT, @UserID , 'SELECT',now(), Email, @cNomee, @cTipoo, @cMorada);
		ELSEIF ( Email = @userId) THEN
			SELECT * FROM utilizador where (EmailUtilizador = @userId);
            INSERT INTO g12_loguser VALUES ( DEFAULT, @UserID , 'SELECT',now(), Email, @Nomee, @Tipoo, @Morada);
		ELSE 
			SELECT * FROM utilizador where (EmailUtilizador = Email AND TipoUtilizador = 'SEG');
            INSERT INTO g12_loguser VALUES (  DEFAULT, @UserID , 'SELECT',now(), Email, @Nomee, @Tipoo, @Morada);
        END IF;
	ELSEIF(CURRENT_ROLE = 'seguranca' OR @role= 'seguranca') THEN 
		SELECT NomeUtilizador FROM utilizador WHERE EmailUtilizador = Email INTO @Nomee;
        SELECT TipoUtilizador FROM utilizador WHERE EmailUtilizador = Email INTO @Tipoo;
        SELECT Morada FROM utilizador WHERE EmailUtilizador = Email INTo @Morada;
        SELECT NomeUtilizador FROM utilizador WHERE EmailUtilizador = @userId INTO @cNomee;
        SELECT TipoUtilizador FROM utilizador WHERE EmailUtilizador = @userId INTO @cTipoo;
		IF (Email = 'NULL') Then
			SELECT * FROM utilizador where (EmailUtilizador = @userId);
            INSERT INTO g12_loguser VALUES ( DEFAULT, @UserID , 'SELECT',now(), Email, @cNomee, @cTipoo, @cMorada);
		ELSEIF ( Email = @userId) THEN
			SELECT * FROM utilizador where (EmailUtilizador = @userId);
            INSERT INTO g12_loguser VALUES ( DEFAULT, @UserID , 'SELECT',now(), Email, @Nomee, @Tipoo, @Morada);
		ELSE
			SELECT * FROM utilizador where (EmailUtilizador = @userId AND EmailUtilizador = Email);
        END IF;
	ELSEIF(CURRENT_ROLE = 'diretor' OR @role= 'diretor' OR CURRENT_ROLE = 'admnistrador' OR @role= 'admnistrador') THEN
		SELECT NomeUtilizador FROM utilizador WHERE EmailUtilizador = Email INTO @Nomee;
        SELECT TipoUtilizador FROM utilizador WHERE EmailUtilizador = Email INTO @Tipoo;        
        SELECT Morada FROM utilizador WHERE EmailUtilizador = Email INTo @Morada;
        SELECT NomeUtilizador FROM utilizador WHERE EmailUtilizador = @userId INTO @cNomee;
        SELECT TipoUtilizador FROM utilizador WHERE EmailUtilizador = @userId INTO @cTipoo;
        IF (Email = 'NULL') Then
			SELECT * FROM utilizador;
             INSERT INTO g12_loguser VALUES ( DEFAULT, @UserID , 'SELECT',now(), Email, @cNomee, @cTipoo, @cMorada);
		ELSE
			SELECT * FROM utilizador where (EmailUtilizador = Email);
            INSERT INTO g12_loguser VALUES (DEFAULT, @UserID , 'SELECT',now(), Email, @Nomee, @Tipoo, @Morada);
		END IF;
            
	END IF;
END